<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
<!-- Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-5461T457HT"></script>
<script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-5461T457HT');
</script>
<!-- End Google Analytics -->
<meta name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge">

    <meta name="author" content="clock">


    <meta name="subtitle" content="Here's liyuhan's personal blog">


    <meta name="description" content="Welcome!">



<title>clock&#39;s blog</title>



    <link rel="icon" href="/favicon.ico">




    <!-- stylesheets list from _config.yml -->
    
    <link rel="stylesheet" href="/css/style.css">
    



    <!-- scripts list from _config.yml -->
    
    <script src="/js/script.js"></script>
    
    <script src="/js/tocbot.min.js"></script>
    



    
    
        
    


<meta name="generator" content="Hexo 7.3.0"></head>

<body>
    <script>
        // this function is used to check current theme before page loaded.
        (() => {
            const currentTheme = window.localStorage && window.localStorage.getItem('theme') || '';
            const isDark = currentTheme === 'dark';
            const pagebody = document.getElementsByTagName('body')[0]
            if (isDark) {
                pagebody.classList.add('dark-theme');
                // mobile
                document.getElementById("mobile-toggle-theme").innerText = "· Dark"
            } else {
                pagebody.classList.remove('dark-theme');
                // mobile
                document.getElementById("mobile-toggle-theme").innerText = "· Light"
            }
        })();
    </script>

    <div class="wrapper">
        <header>
    <nav class="navbar">
        <div class="container">
            <div class="navbar-header header-logo"><a href="/">Clock&#39;s Blog</a></div>
            <div class="menu navbar-right">
                
                    <a class="menu-item" href="/archives">Posts</a>
                
                    <a class="menu-item" href="/category">Categories</a>
                
                    <a class="menu-item" href="/tag">Tags</a>
                
                    <a class="menu-item" href="/about">About</a>
                
                <input id="switch_default" type="checkbox" class="switch_default">
                <label for="switch_default" class="toggleBtn"></label>
            </div>
        </div>
    </nav>

    
    <nav class="navbar-mobile" id="nav-mobile">
        <div class="container">
            <div class="navbar-header">
                <div>
                    <a href="/">Clock&#39;s Blog</a><a id="mobile-toggle-theme">·&nbsp;Light</a>
                </div>
                <div class="menu-toggle" onclick="mobileBtn()">&#9776; Menu</div>
            </div>
            <div class="menu" id="mobile-menu">
                
                    <a class="menu-item" href="/archives">Posts</a>
                
                    <a class="menu-item" href="/category">Categories</a>
                
                    <a class="menu-item" href="/tag">Tags</a>
                
                    <a class="menu-item" href="/about">About</a>
                
            </div>
        </div>
    </nav>

</header>
<script>
    var mobileBtn = function f() {
        var toggleMenu = document.getElementsByClassName("menu-toggle")[0];
        var mobileMenu = document.getElementById("mobile-menu");
        if(toggleMenu.classList.contains("active")){
           toggleMenu.classList.remove("active")
            mobileMenu.classList.remove("active")
        }else{
            toggleMenu.classList.add("active")
            mobileMenu.classList.add("active")
        }
    }
</script>
            <div class="main">
                <div class="container">
    <article class="post-wrap page">
        
        <h2 class="post-title"></h2>
        
        <section class="post-content">
            <table>
<thead>
<tr>
<th><strong>限流策略</strong></th>
<th><strong>基础版用户</strong></th>
<th><strong>专业版用户</strong></th>
</tr>
</thead>
<tbody><tr>
<td>API 流控</td>
<td><a target="_blank" rel="noopener" href="https://www.coze.cn/open/docs/developer_guides/chat_v3">发起对话</a> API 的流控限制为 10 QPS。 <a target="_blank" rel="noopener" href="https://www.coze.cn/open/docs/developer_guides/workflow_run">执行工作流</a>、<a target="_blank" rel="noopener" href="https://www.coze.cn/open/docs/developer_guides/workflow_stream_run">执行工作流（流式响应）</a>、<a target="_blank" rel="noopener" href="https://www.coze.cn/open/docs/developer_guides/workflow_chat">执行对话流</a> API 的流控限制为 100 QPS。 2024年8月15日之后，<a target="_blank" rel="noopener" href="https://www.coze.cn/?utm_medium=&utm_source=api_doc&utm_content=landingpage&utm_id=&utm_campaign=&utm_term=&utm_source_platform=">扣子</a> API 的免费额度为每个账号 100 次 API 调用。一旦累计调用次数超过免费额度，此账号将无法继续使用任何<a target="_blank" rel="noopener" href="https://www.coze.cn/?utm_medium=&utm_source=api_doc&utm_content=landingpage&utm_id=&utm_campaign=&utm_term=&utm_source_platform=">扣子</a> API。API 免费额度不适用于通过<a target="_blank" rel="noopener" href="https://www.coze.cn/?utm_medium=&utm_source=api_doc&utm_content=landingpage&utm_id=&utm_campaign=&utm_term=&utm_source_platform=">扣子</a>平台、其他发布渠道或 SDK 产生的请求。</td>
<td><a target="_blank" rel="noopener" href="https://www.coze.cn/open/docs/developer_guides/chat_v3">发起对话</a> API 的流控限制为 50 QPS。 <a target="_blank" rel="noopener" href="https://www.coze.cn/open/docs/developer_guides/workflow_run">执行工作流</a>、<a target="_blank" rel="noopener" href="https://www.coze.cn/open/docs/developer_guides/workflow_stream_run">执行工作流（流式响应）</a>、<a target="_blank" rel="noopener" href="https://www.coze.cn/open/docs/developer_guides/workflow_chat">执行对话流</a> API 的流控限制为 100 QPS。</td>
</tr>
<tr>
<td>模型流控</td>
<td>基础版用户调用<a target="_blank" rel="noopener" href="https://www.coze.cn/open/docs/developer_guides/chat_v3">发起对话</a>、<a target="_blank" rel="noopener" href="https://www.coze.cn/open/docs/developer_guides/workflow_run">执行工作流</a>、<a target="_blank" rel="noopener" href="https://www.coze.cn/open/docs/developer_guides/workflow_stream_run">执行工作流（流式响应）</a>、<a target="_blank" rel="noopener" href="https://www.coze.cn/open/docs/developer_guides/workflow_chat">执行对话流</a>等涉及模型处理的 API 时，每个用户使用模型的频率受限。 模型的流控限制为： QPS：2 QPM：60 QPD：3000</td>
<td>专业版模型的流控限制取决于火山方舟平台中设置的 RPM，最大可设置为 12000。 设置方式可参考<a target="_blank" rel="noopener" href="https://www.coze.cn/open/docs/coze_pro/access_model">为扣子专业版接入模型</a>。 如需提高频控，可通过<a target="_blank" rel="noopener" href="https://console.volcengine.com/workorder/create?step=2&SubProductID=P00001396">工单平台</a>沟通需求。</td>
</tr>
</tbody></table>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">curl --location --request POST &#x27;https://api.coze.cn/v3/chat&#x27; \</span><br><span class="line">--header &#x27;Authorization: Bearer pat_gzkriBzO9kkigwPmWRCzKEVvCYVY4HUa216xAwsI3pCYYBmgEVfWvvOqJLR8SQzy&#x27; \</span><br><span class="line">--header &#x27;Content-Type: application/json&#x27; \</span><br><span class="line">--data-raw &#x27;&#123;</span><br><span class="line">    &quot;bot_id&quot;: &quot;7468872817791565863&quot;,</span><br><span class="line">    &quot;user_id&quot;: &quot;user_123456&quot;,</span><br><span class="line">    &quot;stream&quot;: true,</span><br><span class="line">    &quot;auto_save_history&quot;: true,</span><br><span class="line">    &quot;additional_messages&quot;: [</span><br><span class="line">        &#123;</span><br><span class="line">            &quot;role&quot;: &quot;user&quot;,</span><br><span class="line">            &quot;content&quot;: &quot;早上好&quot;,</span><br><span class="line">            &quot;content_type&quot;: &quot;text&quot;</span><br><span class="line">        &#125;</span><br><span class="line">    ]</span><br><span class="line">&#125;&#x27;</span><br></pre></td></tr></table></figure>

<p>这个请求已经成功发送，并且服务器返回了一个 <strong>正在处理（in_progress）</strong> 的响应，说明 API 请求是有效的。🎉</p>
<p> <strong>实时返回 AI 回复</strong>，可以将 stream 设置为 true</p>
<p><img src="/Users/liyuhan/Downloads/Hexo/source/images/image-20250208150338259.png" alt="image-20250208150338259"></p>
<p>源代码</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div class=&quot;chat-container&quot;&gt;</span><br><span class="line">    &lt;!-- 顶部标题 --&gt;</span><br><span class="line">    &lt;header class=&quot;chat-header&quot;&gt;Chat with AI&lt;/header&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!-- 消息区域 --&gt;</span><br><span class="line">    &lt;div class=&quot;chat-messages&quot; ref=&quot;chatMessages&quot;&gt;</span><br><span class="line">      &lt;div v-for=&quot;(msg, index) in messages&quot; :key=&quot;index&quot;</span><br><span class="line">           :class=&quot;&#123;&#x27;user-message&#x27;: msg.type === &#x27;user&#x27;, &#x27;ai-message&#x27;: msg.type === &#x27;ai&#x27;&#125;&quot;&gt;</span><br><span class="line">        &#123;&#123; msg.text &#125;&#125;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!-- 输入框 --&gt;</span><br><span class="line">    &lt;div class=&quot;chat-input&quot;&gt;</span><br><span class="line">      &lt;input v-model=&quot;userInput&quot; @keyup.enter=&quot;sendMessage&quot; placeholder=&quot;Type your message...&quot; /&gt;</span><br><span class="line">      &lt;button @click=&quot;sendMessage&quot;&gt;Send&lt;/button&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">export default &#123;</span><br><span class="line">  data() &#123;</span><br><span class="line">    return &#123;</span><br><span class="line">      userInput: &quot;&quot;, // 用户输入的消息</span><br><span class="line">      messages: [&#123; text: &quot;Hello! How can I assist you?&quot;, type: &quot;ai&quot; &#125;], // 初始AI消息</span><br><span class="line">      isSending: false, // 防止重复发送</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;,</span><br><span class="line">  methods: &#123;</span><br><span class="line">    // 发送消息到API</span><br><span class="line">    async sendMessage() &#123;</span><br><span class="line">      if (!this.userInput.trim() || this.isSending) return;</span><br><span class="line"></span><br><span class="line">      // 添加用户消息</span><br><span class="line">      this.messages.push(&#123; text: this.userInput, type: &quot;user&quot; &#125;);</span><br><span class="line"></span><br><span class="line">      const userMessage = this.userInput;</span><br><span class="line">      this.userInput = &quot;&quot;;</span><br><span class="line">      this.isSending = true;</span><br><span class="line">      try &#123;</span><br><span class="line">        // 调用API，获取AI回复</span><br><span class="line">        const response = await fetch(&quot;https://api.coze.cn/v3/chat&quot;, &#123;</span><br><span class="line">          method: &quot;POST&quot;,</span><br><span class="line">          headers: &#123;</span><br><span class="line">            Authorization: `Bearer pat_gzkriBzO9kkigwPmWRCzKEVvCYVY4HUa216xAwsI3pCYYBmgEVfWvvOqJLR8SQzy`, // 使用有效的 API Token</span><br><span class="line">            &quot;Content-Type&quot;: &quot;application/json&quot;,</span><br><span class="line">          &#125;,</span><br><span class="line">          body: JSON.stringify(&#123;</span><br><span class="line">            bot_id: &quot;7468872817791565863&quot;, // 确保填写有效的 bot ID</span><br><span class="line">            &quot;user_id&quot;: &quot;user_123456&quot;,</span><br><span class="line">            messages: [&#123; role: &quot;user&quot;, content: userMessage &#125;],</span><br><span class="line">          &#125;),</span><br><span class="line">        &#125;);</span><br><span class="line">        const data = await response.json();</span><br><span class="line">        console.log(&quot;API Response:&quot;, data); // 打印 API 返回的数据</span><br><span class="line"></span><br><span class="line">        // 如果 API 请求成功并返回内容</span><br><span class="line">        if (data.choices &amp;&amp; data.choices.length &gt; 0) &#123;</span><br><span class="line">          const aiResponse = data.choices[0].message.content || &quot;AI 没有返回有效消息&quot;;</span><br><span class="line">          this.messages.push(&#123; text: aiResponse, type: &quot;ai&quot; &#125;);</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">          this.messages.push(&#123; text: &quot;AI 没有返回有效消息&quot;, type: &quot;ai&quot; &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125; catch (error) &#123;</span><br><span class="line">        console.error(&quot;API 请求失败:&quot;, error);</span><br><span class="line">        this.messages.push(&#123; text: &quot;AI 发生错误，请稍后重试。&quot;, type: &quot;ai&quot; &#125;);</span><br><span class="line">      &#125; finally &#123;</span><br><span class="line">        this.isSending = false;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      // 让消息区域滚动到底部</span><br><span class="line">      this.$nextTick(() =&gt; this.scrollToBottom());</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    // 滚动到最新消息</span><br><span class="line">    scrollToBottom() &#123;</span><br><span class="line">      if (this.$refs.chatMessages) &#123;</span><br><span class="line">        this.$refs.chatMessages.scrollTop = this.$refs.chatMessages.scrollHeight;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">&#125;;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style scoped&gt;</span><br><span class="line">/* 整体布局 */</span><br><span class="line">.chat-container &#123;</span><br><span class="line">  display: flex;</span><br><span class="line">  flex-direction: column;</span><br><span class="line">  width: 90vw;</span><br><span class="line">  max-width: 1200px;</span><br><span class="line">  height: 80vh;</span><br><span class="line">  margin: 5vh auto;</span><br><span class="line">  background: #f8f8f8;</span><br><span class="line">  border-radius: 10px;</span><br><span class="line">  box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/* 头部样式 */</span><br><span class="line">.chat-header &#123;</span><br><span class="line">  background: #4a90e2;</span><br><span class="line">  color: white;</span><br><span class="line">  text-align: center;</span><br><span class="line">  padding: 15px;</span><br><span class="line">  font-size: 1.5rem;</span><br><span class="line">  border-radius: 10px 10px 0 0;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/* 消息列表 */</span><br><span class="line">.chat-messages &#123;</span><br><span class="line">  flex: 1;</span><br><span class="line">  padding: 20px;</span><br><span class="line">  overflow-y: auto;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/* 消息气泡 */</span><br><span class="line">.user-message &#123;</span><br><span class="line">  background: #d1e8ff;</span><br><span class="line">  padding: 10px;</span><br><span class="line">  border-radius: 10px;</span><br><span class="line">  max-width: 70%;</span><br><span class="line">  margin: 10px 0;</span><br><span class="line">  align-self: flex-end;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.ai-message &#123;</span><br><span class="line">  background: #e0e0e0;</span><br><span class="line">  padding: 10px;</span><br><span class="line">  border-radius: 10px;</span><br><span class="line">  max-width: 70%;</span><br><span class="line">  margin: 10px 0;</span><br><span class="line">  align-self: flex-start;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/* 输入框 */</span><br><span class="line">.chat-input &#123;</span><br><span class="line">  display: flex;</span><br><span class="line">  padding: 15px;</span><br><span class="line">  background: white;</span><br><span class="line">  border-radius: 0 0 10px 10px;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.chat-input input &#123;</span><br><span class="line">  flex: 1;</span><br><span class="line">  padding: 10px;</span><br><span class="line">  border: 1px solid #ddd;</span><br><span class="line">  border-radius: 5px;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.chat-input button &#123;</span><br><span class="line">  margin-left: 10px;</span><br><span class="line">  padding: 10px;</span><br><span class="line">  background: #4a90e2;</span><br><span class="line">  color: white;</span><br><span class="line">  border: none;</span><br><span class="line">  border-radius: 5px;</span><br><span class="line">  cursor: pointer;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>

<p>测试代码</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div class=&quot;chat-container&quot;&gt;</span><br><span class="line">    &lt;div class=&quot;messages&quot;&gt;</span><br><span class="line">      &lt;div v-for=&quot;(msg, index) in messages&quot; :key=&quot;index&quot; :class=&quot;msg.role&quot;&gt;</span><br><span class="line">        &#123;&#123; msg.content &#125;&#125;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    &lt;input v-model=&quot;userInput&quot; placeholder=&quot;输入你的问题...&quot; @keyup.enter=&quot;sendMessage&quot;&gt;</span><br><span class="line">    &lt;button @click=&quot;sendMessage&quot;&gt;发送&lt;/button&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">import axios from &quot;axios&quot;;</span><br><span class="line"></span><br><span class="line">export default &#123;</span><br><span class="line">  data() &#123;</span><br><span class="line">    return &#123;</span><br><span class="line">      userInput: &quot;&quot;,  // 用户输入</span><br><span class="line">      messages: []  // 存储聊天记录</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;,</span><br><span class="line">  methods: &#123;</span><br><span class="line">    async sendMessage() &#123;</span><br><span class="line">      if (!this.userInput.trim()) return;</span><br><span class="line">      </span><br><span class="line">      // 添加用户消息</span><br><span class="line">      this.messages.push(&#123; role: &quot;user&quot;, content: this.userInput &#125;);</span><br><span class="line"></span><br><span class="line">      const botId = &quot;7468872817791565863&quot;;</span><br><span class="line">      const token = &quot;Bearer pat_gzkriBzO9kkigwPmWRCzKEVvCYVY4HUa216xAwsI3pCYYBmgEVfWvvOqJLR8SQzy&quot;;</span><br><span class="line">      </span><br><span class="line">      // 清空输入框</span><br><span class="line">      let userMessage = this.userInput;</span><br><span class="line">      this.userInput = &quot;&quot;;</span><br><span class="line"></span><br><span class="line">      try &#123;</span><br><span class="line">        const eventSource = new EventSource(`https://api.coze.cn/v3/chat?bot_id=$&#123;botId&#125;&amp;user_id=user_123456&amp;stream=true`, &#123;</span><br><span class="line">          headers: &#123;</span><br><span class="line">            &quot;Authorization&quot;: token,</span><br><span class="line">            &quot;Content-Type&quot;: &quot;application/json&quot;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        let botMessage = &#123; role: &quot;assistant&quot;, content: &quot;&quot; &#125;;</span><br><span class="line">        this.messages.push(botMessage); // 先插入一个空的 AI 回复</span><br><span class="line">        </span><br><span class="line">        eventSource.onmessage = (event) =&gt; &#123;</span><br><span class="line">          let data = JSON.parse(event.data);</span><br><span class="line">          if (data.type === &quot;answer&quot;) &#123;</span><br><span class="line">            botMessage.content += data.content;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        eventSource.onerror = () =&gt; &#123;</span><br><span class="line">          console.error(&quot;SSE 连接错误&quot;);</span><br><span class="line">          eventSource.close();</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">      &#125; catch (error) &#123;</span><br><span class="line">        console.error(&quot;请求失败&quot;, error);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style&gt;</span><br><span class="line">.chat-container &#123;</span><br><span class="line">  max-width: 600px;</span><br><span class="line">  margin: auto;</span><br><span class="line">  padding: 20px;</span><br><span class="line">  border: 1px solid #ddd;</span><br><span class="line">  border-radius: 5px;</span><br><span class="line">&#125;</span><br><span class="line">.messages &#123;</span><br><span class="line">  height: 300px;</span><br><span class="line">  overflow-y: auto;</span><br><span class="line">  border-bottom: 1px solid #ddd;</span><br><span class="line">  padding: 10px;</span><br><span class="line">&#125;</span><br><span class="line">.user &#123;</span><br><span class="line">  text-align: right;</span><br><span class="line">  color: blue;</span><br><span class="line">&#125;</span><br><span class="line">.assistant &#123;</span><br><span class="line">  text-align: left;</span><br><span class="line">  color: green;</span><br><span class="line">&#125;</span><br><span class="line">input &#123;</span><br><span class="line">  width: 80%;</span><br><span class="line">  padding: 10px;</span><br><span class="line">  margin-right: 10px;</span><br><span class="line">&#125;</span><br><span class="line">button &#123;</span><br><span class="line">  padding: 10px;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>

<h2 id="先发布智能体"><a href="#先发布智能体" class="headerlink" title="先发布智能体"></a><strong>先发布智能体</strong></h2><p>你不需要 <strong>全部 API</strong>，只需要 <strong>核心 API</strong>：</p>
<p>​	1.	<strong>发布智能体 &#x2F;v1&#x2F;bot&#x2F;publish</strong></p>
<p>​	2.	<strong>创建会话 &#x2F;v1&#x2F;conversation&#x2F;create</strong></p>
<p>​	3.	<strong>发送消息 &#x2F;v3&#x2F;chat</strong></p>
<p>​	4.	<strong>获取历史记录 &#x2F;v1&#x2F;conversation&#x2F;{conversation_id}&#x2F;messages</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">curl --location --request POST &#x27;https://api.coze.cn/v1/bot/publish&#x27; \</span><br><span class="line">--header &#x27;Authorization: Bearer pat_gzkriBzO9kkigwPmWRCzKEVvCYVY4HUa216xAwsI3pCYYBmgEVfWvvOqJLR8SQzy&#x27; \</span><br><span class="line">--header &#x27;Content-Type: application/json&#x27; \</span><br><span class="line">--data &#x27;&#123;</span><br><span class="line">    &quot;bot_id&quot;: &quot;7468872817791565863&quot;,</span><br><span class="line">    &quot;connector_ids&quot;: [&quot;1024&quot;],</span><br><span class="line">    &quot;description&quot;: &quot;发布我的 AI 机器人&quot;</span><br><span class="line">&#125;&#x27;</span><br></pre></td></tr></table></figure>

<p>返回结果</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#123;&quot;code&quot;:0,&quot;msg&quot;:&quot;&quot;,&quot;data&quot;:&#123;&quot;bot_id&quot;:&quot;7468872817791565863&quot;,&quot;version&quot;:&quot;1739001712363&quot;&#125;&#125;%                                                                  liyuhan@liyuhandebijibendiannao ~ % </span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="创建会话"><a href="#创建会话" class="headerlink" title="创建会话"></a>创建会话</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">curl --location --request POST &#x27;https://api.coze.cn/v1/conversation/create&#x27; \</span><br><span class="line">--header &#x27;Authorization: Bearer pat_gzkriBzO9kkigwPmWRCzKEVvCYVY4HUa216xAwsI3pCYYBmgEVfWvvOqJLR8SQzy&#x27; \</span><br><span class="line">--header &#x27;Content-Type: application/json&#x27; \</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;code&quot;: 0,</span><br><span class="line">  &quot;data&quot;: &#123;</span><br><span class="line">    &quot;created_at&quot;: 1739003475,</span><br><span class="line">    &quot;id&quot;: &quot;7468963045729959976&quot;,  // 这是新的 conversation_id</span><br><span class="line">    &quot;last_section_id&quot;: &quot;7468963045729959976&quot;,  // 最后一个会话段的 ID</span><br><span class="line">    &quot;meta_data&quot;: &#123;&#125;  // 其他元数据</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;msg&quot;: &quot;&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>“id”: “7468963045729959976”, &#x2F;&#x2F; 这是你的 conversation_id</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">curl --location --request GET &#x27;https://api.coze.cn/v1/conversation/retrieve?conversation_id=7468963045729959976&#x27; \</span><br><span class="line">--header &#x27;Authorization: Bearer pat_gzkriBzO9kkigwPmWRCzKEVvCYVY4HUa216xAwsI3pCYYBmgEVfWvvOqJLR8SQzy&#x27; \</span><br><span class="line">--header &#x27;Content-Type: application/json&#x27;</span><br></pre></td></tr></table></figure>



<h2 id="工作流"><a href="#工作流" class="headerlink" title="工作流"></a>工作流</h2><p><a target="_blank" rel="noopener" href="https://www.coze.cn/work_flow?space_id=7468627348678705178&workflow_id=7468972466682937363">https://www.coze.cn/work_flow?space_id=7468627348678705178&amp;workflow_id=7468972466682937363</a></p>
<p><img src="/Users/liyuhan/Downloads/Hexo/source/images/image-20250208170835769.png" alt="image-20250208170835769"></p>
<p><img src="/Users/liyuhan/Downloads/Hexo/source/images/image-20250208171308533.png" alt="image-20250208171308533"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">curl -X POST &#x27;https://api.coze.cn/v1/workflow/run&#x27; \</span><br><span class="line">-H &quot;Authorization: Bearer pat_gzkriBzO9kkigwPmWRCzKEVvCYVY4HUa216xAwsI3pCYYBmgEVfWvvOqJLR8SQzy&quot; \</span><br><span class="line">-H &quot;Content-Type: application/json&quot; \</span><br><span class="line">-d &#x27;&#123;</span><br><span class="line">  &quot;parameters&quot;: &#123;</span><br><span class="line">    &quot;article_url&quot;: &quot;https://acm.sdut.edu.cn/onlinejudge3/&quot;,</span><br><span class="line">    &quot;user_id&quot;: &quot;user_123456&quot;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;workflow_id&quot;: &quot;7469002841937838114&quot;</span><br><span class="line">&#125;&#x27;</span><br></pre></td></tr></table></figure>

<p><img src="/Users/liyuhan/Downloads/Hexo/source/images/image-20250208194944308.png" alt="image-20250208194944308"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">curl -X POST &#x27;https://api.coze.cn/v1/workflow/run&#x27; \</span><br><span class="line">-H &quot;Authorization: Bearer pat_gzkriBzO9kkigwPmWRCzKEVvCYVY4HUa216xAwsI3pCYYBmgEVfWvvOqJLR8SQzy&quot; \</span><br><span class="line">-H &quot;Content-Type: application/json&quot; \</span><br><span class="line">-d &#x27;&#123;</span><br><span class="line">    &quot;workflow_id&quot;: &quot;7469002841937838114&quot;,</span><br><span class="line">    &quot;parameters&quot;: &#123;</span><br><span class="line">        &quot;article_url&quot;: &quot;https://acm.sdut.edu.cn/onlinejudge3/&quot;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;&#x27;</span><br></pre></td></tr></table></figure>

<p>7469082946461499392</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div id=&quot;app&quot;&gt;</span><br><span class="line">    &lt;div class=&quot;chat-container&quot;&gt;</span><br><span class="line">      &lt;div class=&quot;messages&quot;&gt;</span><br><span class="line">        &lt;div v-for=&quot;(message, index) in messages&quot; :key=&quot;index&quot; :class=&quot;message.type&quot;&gt;</span><br><span class="line">          &lt;p&gt;&#123;&#123; message.text &#125;&#125;&lt;/p&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line"></span><br><span class="line">      &lt;div class=&quot;input-container&quot;&gt;</span><br><span class="line">        &lt;input v-model=&quot;userInput&quot; @keyup.enter=&quot;sendMessage&quot; placeholder=&quot;请输入消息...&quot; /&gt;</span><br><span class="line">        &lt;button @click=&quot;sendMessage&quot;&gt;发送&lt;/button&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt; </span><br><span class="line">&lt;!--模版部分，消息展示区域，显示用户与AI聊天记录，这里使用v-for循环遍历messages数组，进而渲染每一条消息--&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">export default &#123;</span><br><span class="line">  data() &#123;</span><br><span class="line">    return &#123;</span><br><span class="line">      userInput: &#x27;&#x27;,</span><br><span class="line">      messages: [],</span><br><span class="line">      conversationId: null,</span><br><span class="line">      api_token: &#x27;Bearer pat_gzkriBzO9kkigwPmWRCzKEVvCYVY4HUa216xAwsI3pCYYBmgEVfWvvOqJLR8SQzy&#x27; // 这里替换为你的 API token</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;,</span><br><span class="line">  methods: &#123;</span><br><span class="line">    async sendMessage() &#123;</span><br><span class="line">      if (!this.userInput.trim()) return; // 如果输入为空则不发送消息</span><br><span class="line"></span><br><span class="line">      // 1. 判断是否已存在会话,参考文档创建消息</span><br><span class="line">      if (!this.conversationId) &#123;</span><br><span class="line">        const response = await (await fetch(&#x27;https://api.coze.cn/v1/conversation/create&#x27;, &#123;</span><br><span class="line">          method: &#x27;POST&#x27;,</span><br><span class="line">          headers: &#123;</span><br><span class="line">            Authorization: this.api_token,</span><br><span class="line">            &#x27;Content-Type&#x27;: &#x27;application/json&#x27;,</span><br><span class="line">          &#125;,</span><br><span class="line">        &#125;)).json();</span><br><span class="line">        this.conversationId = response.data.id;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      // 2. 发送用户消息给AI，参考发起对话</span><br><span class="line">      let response = await (await fetch(`https://api.coze.cn/v3/chat?conversation_id=$&#123;this.conversationId&#125;`, &#123;</span><br><span class="line">        method: &#x27;POST&#x27;,</span><br><span class="line">        headers: &#123;</span><br><span class="line">          Authorization: this.api_token,</span><br><span class="line">          &#x27;Content-Type&#x27;: &#x27;application/json&#x27;,</span><br><span class="line">        &#125;,</span><br><span class="line">        body: JSON.stringify(&#123;</span><br><span class="line">          bot_id: &#x27;7468872817791565863&#x27;, // AI bot的ID</span><br><span class="line">          user_id: &#x27;1&#x27;,</span><br><span class="line">          additional_messages: [&#123;</span><br><span class="line">            role: &#x27;user&#x27;,</span><br><span class="line">            content_type: &#x27;text&#x27;,</span><br><span class="line">            content: this.userInput,</span><br><span class="line">          &#125;],</span><br><span class="line">        &#125;),</span><br><span class="line">      &#125;)).json();</span><br><span class="line"></span><br><span class="line">      // 获取聊天的ID</span><br><span class="line">      const chatId = response.data.id;</span><br><span class="line"></span><br><span class="line">      // 将用户输入的消息放入消息记录</span><br><span class="line">      this.messages.push(&#123; text: this.userInput, type: &#x27;user&#x27; &#125;);</span><br><span class="line"></span><br><span class="line">      // 清空用户输入框</span><br><span class="line">      this.userInput = &#x27;&#x27;;</span><br><span class="line"></span><br><span class="line">      // 3. 每隔1秒查询AI是否已经处理完用户消息</span><br><span class="line">      const timer = setInterval(async () =&gt; &#123;</span><br><span class="line">        response = await (await fetch(`https://api.coze.cn/v3/chat/retrieve?conversation_id=$&#123;this.conversationId&#125;&amp;chat_id=$&#123;chatId&#125;`, &#123;</span><br><span class="line">          method: &#x27;GET&#x27;,</span><br><span class="line">          headers: &#123;</span><br><span class="line">            Authorization: this.api_token,</span><br><span class="line">            &#x27;Content-Type&#x27;: &#x27;application/json&#x27;,</span><br><span class="line">          &#125;,</span><br><span class="line">        &#125;)).json();</span><br><span class="line"></span><br><span class="line">        // 如果消息处理未完成，继续等待</span><br><span class="line">        if (response.data.status !== &#x27;completed&#x27;) &#123;</span><br><span class="line">          return;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        // 清除定时器</span><br><span class="line">        clearInterval(timer);</span><br><span class="line"></span><br><span class="line">        // 获取AI的回答</span><br><span class="line">        response = await (await fetch(`https://api.coze.cn/v3/chat/message/list?conversation_id=$&#123;this.conversationId&#125;&amp;chat_id=$&#123;chatId&#125;`, &#123;</span><br><span class="line">          method: &#x27;GET&#x27;,</span><br><span class="line">          headers: &#123;</span><br><span class="line">            Authorization: this.api_token,</span><br><span class="line">            &#x27;Content-Type&#x27;: &#x27;application/json&#x27;,</span><br><span class="line">          &#125;,</span><br><span class="line">        &#125;)).json();</span><br><span class="line"></span><br><span class="line">        // 将AI的消息放入消息记录</span><br><span class="line">        response.data.forEach((msg) =&gt; &#123;</span><br><span class="line">          if (msg.type !== &#x27;answer&#x27;) return; // 只显示回答类型的消息</span><br><span class="line">          this.messages.push(&#123; text: msg.content, type: &#x27;ai&#x27;, msgId: msg.id &#125;);</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;, 1000);</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style scoped&gt;</span><br><span class="line">#app &#123;</span><br><span class="line">  font-family: Arial, sans-serif;</span><br><span class="line">  display: flex;</span><br><span class="line">  justify-content: center;</span><br><span class="line">  align-items: center;</span><br><span class="line">  height: 100vh;</span><br><span class="line">  background-color: #f4f4f4;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.chat-container &#123;</span><br><span class="line">  width: 400px;</span><br><span class="line">  background-color: #fff;</span><br><span class="line">  border-radius: 8px;</span><br><span class="line">  box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);</span><br><span class="line">  padding: 20px;</span><br><span class="line">  display: flex;</span><br><span class="line">  flex-direction: column;</span><br><span class="line">  height: 500px;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.messages &#123;</span><br><span class="line">  flex: 1;</span><br><span class="line">  overflow-y: auto;</span><br><span class="line">  margin-bottom: 20px;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.messages .user &#123;</span><br><span class="line">  text-align: right;</span><br><span class="line">  margin-bottom: 10px;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.messages .ai &#123;</span><br><span class="line">  text-align: left;</span><br><span class="line">  margin-bottom: 10px;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.input-container &#123;</span><br><span class="line">  display: flex;</span><br><span class="line">  justify-content: space-between;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.input-container input &#123;</span><br><span class="line">  width: 80%;</span><br><span class="line">  padding: 8px;</span><br><span class="line">  border: 1px solid #ccc;</span><br><span class="line">  border-radius: 4px;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.input-container button &#123;</span><br><span class="line">  width: 15%;</span><br><span class="line">  padding: 8px;</span><br><span class="line">  background-color: #4CAF50;</span><br><span class="line">  color: white;</span><br><span class="line">  border: none;</span><br><span class="line">  border-radius: 4px;</span><br><span class="line">  cursor: pointer;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.input-container button:hover &#123;</span><br><span class="line">  background-color: #45a049;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>


        </section>
    </article>
</div>

            </div>
            <footer id="footer" class="footer">
    <div class="contact-info">
        <h3>Contact Me:</h3>
        <ul>
            <strong>CSDN:</strong> <a href="https://blog.csdn.net/2401_87202881?type=blog" target="_blank">点击访问</a>
            <strong>QQ:</strong> <a target="_blank" rel="noopener" href="https://wpa.qq.com/msgrd?v=3&uin=2100892868&site=qq&menu=yes">点击联系我</a>
            <strong>Email:</strong> <a href="mailto:你的邮箱地址">2100892868@qq.com</a>
            <strong>GitHub:</strong> <a href="https://github.com/ldz3582" target="_blank">点击访问我的GitHub</a>
            <strong>WeChat:</strong> Clock_LHSC
        </ul>
    </div>
    <div class="copyright">
        <span>© clock | Powered by <a href="https://hexo.io" target="_blank">Hexo</a> & <a href="https://github.com/Siricee/hexo-theme-Chic" target="_blank">Chic</a></span>
    </div>
</footer>
    </div>
</body>

</html>